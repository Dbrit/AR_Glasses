// filename ******** tests.c ************** 
// Lisong Sun, Kerry Tu, Dakota Britton, Casey Kim
// Created: October 26, 2021
// C file with test/debugging functions for each module.
// Lab 11
// TA: Matthew Yu
// Last edited: November 25, 2021

#include "tests.h"

const unsigned short testBMP[] = {
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618,
 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618,
 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618,
 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x079F, 0x079F, 0x079F, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0xC618, 0xC618, 0xC618, 0x0000, 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC618, 0x0000, 0x0000, 0x0000, 0x0000,
 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079F,
 0x0000, 0x0000, 0x0000, 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x079F, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
 0x0000,

};

void Test_LCD(void) {
	//test text
	ST7735_SetCursor(0,0);
	ST7735_OutString("123451234512345123451234512345");								 //can't see left 3 char and right 2 char
	ST7735_SetCursor(0,1);																						 //giving 20 usable char - ROFFSET/6 char
	ST7735_OutUDec(12345);
	//test compass
	for(uint8_t offset = 0; offset < 30; offset++){
		ST7735_DrawChar(offset*6+6,7*5,'A',ST7735_WHITE,ST7735_BLACK,1); //can print 25 chars long, aka 150 pixels
	}																																	 //compass must be 25-ROFFSET char long
	//text BMPs
	ST7735_DrawBitmap(-10,85,testBMP,25,25);
	ST7735_DrawBitmap(150,85,testBMP,25,25);
	while (1);
}

void Test_API(void) {
	ST7735_FillScreen(ST7735_BLACK);
	while(1) {
		ST7735_SetCursor(0,0);
		ST7735_OutString(API_Get_Time());
		ST7735_SetCursor(0,1);
		ST7735_OutString(API_Get_Date());
		ST7735_SetCursor(0,2);
		ST7735_OutString(API_Get_DoW());
		ST7735_SetCursor(0,3);
		ST7735_OutString(API_Get_WeatherStatus());
		ST7735_SetCursor(0,4);
		ST7735_OutString(API_Get_Temperature());
		ST7735_SetCursor(0,5);
		ST7735_OutString(API_Get_Humidity());
	}
}

extern const unsigned short humBMP[];
extern const unsigned short sunnyBMP[];
extern const unsigned short cloudyBMP[];
extern const unsigned short snowyBMP[];
extern const unsigned short rainyBMP[];
extern const unsigned short thunderBMP[];

void Test_Image(void) {
	ST7735_SetCursor(6, 4);
	ST7735_OutString("Austin, TX");
	ST7735_SetCursor(12, 6);
	ST7735_OutString("99.99");
	ST7735_OutString(" F");
	ST7735_DrawBitmap(84,86,humBMP,5,7);
	ST7735_SetCursor(13, 8);
	ST7735_OutString("99");
	ST7735_OutString(" %");
	while(1) {
		ST7735_DrawBitmap(100,85,cloudyBMP,25,25);
		SysTick80_Wait10ms(100);
		ST7735_DrawBitmap(100,85,sunnyBMP,25,25);
		SysTick80_Wait10ms(100);
		ST7735_DrawBitmap(100,85,snowyBMP,25,25);
		SysTick80_Wait10ms(100);
		ST7735_DrawBitmap(100,85,rainyBMP,25,25);
		SysTick80_Wait10ms(100);
		ST7735_DrawBitmap(100,85,thunderBMP,25,25);
		SysTick80_Wait10ms(100);
	}
}

// test DHT11 readings
void Test_DHT11(void) {
	ST7735_FillScreen(ST7735_BLACK);
	while(1) {
		ST7735_SetCursor(0,0);
		ST7735_sDecOut2(DHT11_GetTemp());
		ST7735_SetCursor(0,1);
		ST7735_sDecOut2(DHT11_GetHumidity());
	}
}

#define COMP_X 80
#define COMP_Y 70
extern int16_t magData[3];
// test magnetometer
void Test_ICM20948(void) {
	ST7735_FillScreen(ST7735_BLACK);
	
	for (int i = 0; i < 400; i++) { // draw a circle
		double theta = 2*3.14*i/400;
		ST7735_DrawPixel(COMP_X+(int)50*sin(theta),COMP_Y-(int)50*cos(theta),ST7735_CYAN);
	} 
	
	while (1) {		
		int32_t heading = ICM20948_GetDirection();
		ST7735_SetCursor(0,0);
		ST7735_OutString("Angle: ");
		ST7735_sDecOut2(heading);
		ST7735_OutString("      ");
		
		static double Ctheta;
			
		//erase
		ST7735_Line(COMP_X, COMP_Y, COMP_X+(int)35*sin(Ctheta), COMP_Y-(int)35*cos(Ctheta), ST7735_BLACK); // minute hand
		Ctheta = (heading-180)*3.14/180+3.14;
		//draw
		ST7735_Line(COMP_X, COMP_Y, COMP_X+(int)35*sin(Ctheta), COMP_Y-(int)35*cos(Ctheta), ST7735_WHITE); // minute hand
	}
	
}
